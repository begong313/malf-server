{% extends 'layout.html' %} {% block content %}
<h1>{{title}}</h1>
<a href="/" id="exit-btn">방 나가기</a>
<fieldset>
    <legend>채팅 내용</legend>
    <div id="chat-list">
        {% for chat in chats %} {% if chat.user === user %}
        <div class="mine"></div>
        {% elif chat.user === 'system' %}
        <div class="system">
            <div>{{chat.chat}}</div>
        </div>
        {% else %}
        <div class="other">
            <div>{{chat.user}}</div>
            {% if chat.gif %}
            <img src="/gif/{{chat.gif}}" />
            {% else %}
            <div>{{chat.chat}}</div>
            {% endif %}
        </div>
        {% endif %} {% endfor %}
    </div>
</fieldset>
<button onclick="send()">testtest</button>
<script src="/chatTest/socket.io.js"></script>
<script>
    const socket = io.connect("http://localhost:8000/chat", {
        path: "/chatTest",
    });
    const urlData = new URL(location).pathname.split("/").at(-1);
    console.log(urlData);

    socket.emit("join", { room: urlData, sender: "test1" });
    socket.on("join", function (data) {
        console.log(data);
        const div = document.createElement("div");
        div.classList.add("system");
        const chat = document.createElement("div");
        div.textContent = data.chat;
        div.appendChild(chat);
        document.querySelector("#chat-list").appendChild(div);
    });
    socket.on("chat", function (data) {
        console.log("Dfasdfs");
        console.log(data);
    });
    socket.on("test", function (data) {
        console.log("서버로 chat 전송");
        socket.emit("chat", {
            room: urlData,
            sender: "test1",
            message: "dfsd",
        });
    });
    function send() {
        console.log("보냄");
        socket.emit("chat", {
            room: urlData,
            sender: "test1",
            message: "dfsd",
        });
    }
    socket.on("image", function (data) {
        console.log(data);
    });
    socket.on("exit", function (data) {
        const div = document.createElement("div");
        div.classList.add("system");
        const chat = document.createElement("div");
        div.textContent = data.chat;
        div.appendChild(chat);
        document.querySelector("#chat-list").appendChild(div);
    });
</script>
{% endblock %}
